# Enhanced tmux configuration for cross-platform compatibility
# Keep default prefix C-b (standard and vanilla approach)

# Basic settings
set -g mouse on
setw -g mode-keys vi
set -g history-limit 100000
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Automatically renumber windows when one is closed
set -g renumber-windows on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Better split commands (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# Reload config
bind r source-file ~/.tmux.conf \; display-message "tmux config reloaded!"

# Pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -r C-h previous-window
bind -r C-l next-window

# Session navigation
bind -r ( switch-client -p
bind -r ) switch-client -n

# Copy mode improvements
bind Enter copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi r send -X rectangle-toggle

# Platform-specific clipboard integration
# macOS: use pbcopy/pbpaste
if-shell 'test "$(uname)" = "Darwin"' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"'

# Linux: use xclip or wl-clipboard
if-shell 'test "$(uname)" = "Linux"' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard"'

# If in Kitty terminal, use kitty's clipboard
if-shell 'test -n "$KITTY_WINDOW_ID"' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "kitty +kitten clipboard"'

# Quick pane layouts
bind M-1 select-layout even-horizontal
bind M-2 select-layout even-vertical
bind M-3 select-layout main-horizontal
bind M-4 select-layout main-vertical
bind M-5 select-layout tiled

# Status bar configuration
set -g status-position bottom
set -g status-bg default
set -g status-fg white
set -g status-left-length 40
set -g status-right-length 80

# Status left: session name and window count
set -g status-left "#[fg=green]#S #[fg=yellow]#I/#P "

# Status right: load, date and time
set -g status-right "#[fg=cyan]#(whoami)@#h #[fg=yellow]%Y-%m-%d #[fg=green]%H:%M:%S "

# Window status format
setw -g window-status-format "#I:#W#F"
setw -g window-status-current-format "#[fg=black,bg=yellow] #I:#W#F "

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour39

# Message style
set -g message-style bg=colour39,fg=black
set -g message-command-style bg=colour39,fg=black

# Clock mode
setw -g clock-mode-colour colour39
setw -g clock-mode-style 24

# Window options
setw -g automatic-rename on
setw -g allow-rename off

# Don't exit when last shell exits
set -g exit-unattached off

# Escape time (for nvim)
set -sg escape-time 0

# Focus events (for nvim)
set -g focus-events on

# Plugin system (tpm) - optional but useful
# Uncomment these lines if you want to use tmux plugins
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Restore tmux sessions automatically
# set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# run '~/.tmux/plugins/tpm/tpm'x C-b (no remaps)
set -g mouse on
setw -g mode-keys vi
set -g history-limit 100000

# better splits and copy
bind | split-window -h
bind - split-window -v
bind r source-file ~/.tmux.conf \; display-message "tmux reloaded"

# clipboard integration (mac & linux)
# macOS: pbcopy/pbpaste; Linux/Kitty: use terminal’s copy
if -b 'command -v pbcopy >/dev/null' 'bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"'
if -b 'command -v xclip >/dev/null'  'bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard"'

# status—clean and readable
set -g status-bg default
set -g status-fg white
set -g status-left "#S "
set -g status-right "#(whoami) | %Y-%m-%d %H:%M "
